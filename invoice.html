<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTC Ticket Generator - Updated</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.js"></script>
    <style>
        @font-face {
            font-family: 'alo';
            src: url('alo.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --backg: url("blank-ticket.JPG"); /*Background */
            --disp: hidden;
            --reld: absolute;
            --color-black: #000000;
            --color-white: #ffffff;
            --color-gray-light: #f8f9fa;
            --color-gray-medium: #6c757d;
            --color-gray-dark: #343a40;
            --color-accent: #000000;
            --transition-fast: 0.2s;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--color-black);
            line-height: 1.6;
        }

        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .app-logo {
            height: 35px;
            margin-bottom: 10px;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-black);
            margin: 0;
            letter-spacing: -0.5px;
        }

        .ticket-preview {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f3f4;
            padding: 24px;
            margin-bottom: 20px;
            transition: all var(--transition-fast) ease;
        }

        .card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-black);
            margin: 0 0 16px 0;
            text-align: center;
        }

        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 160px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--color-black);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--color-black);
            transition: all var(--transition-fast) ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--color-black);
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .btn {
            background: var(--color-black);
            color: white;
            border: 2px solid var(--color-black);
            padding: 16px 24px;
            border-radius: 12px;
            cursor: pointer;
            margin: 8px 4px;
            font-size: 15px;
            font-weight: 600;
            transition: all var(--transition-fast) ease;
            width: 100%;
            max-width: 280px;
            box-sizing: border-box;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: white;
            color: var(--color-black);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--color-black);
            color: white;
        }

        .btn-success {
            background: var(--color-black);
            border-color: var(--color-black);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--color-black);
            border: 2px solid var(--color-black);
        }

        .btn-outline:hover {
            background: var(--color-black);
            color: white;
        }

        .InputGroup {
            display: flex;
            height: 60px;
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }

        input[type="radio"] {
            display: none;
        }

        .InputGroup label {
            display: flex;
            flex: 1;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            background: white;
            color: var(--color-black);
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all var(--transition-fast) ease;
            border-right: 1px solid #e9ecef;
        }

        .InputGroup label:last-of-type {
            border-right: none;
        }

        input[type="radio"]:checked + label {
            background: var(--color-black);
            color: white;
        }

        input[type="radio"]:hover:not(:checked) + label {
            background: #f8f9fa;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e9ecef;
        }

        th, td {
            padding: 6px 8px;
            text-align: left;
            border-bottom: 1px solid #f1f3f4;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--color-black);
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--color-black);
            font-weight: 500;
            font-size: 12px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        hr {
            border: none;
            border-top: 1px solid #e9ecef;
            margin: 8px 0;
        }

        .ticket-container {
            position: relative;
            width: 398px;
            height: 553px;
            background-image: url('blank-ticket.JPG');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            border: none;
            margin: 20px auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            border-radius: 16px;
            overflow: hidden;
        }

        .fields-container {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .ticket-field {
            position: absolute;
            background: transparent;
            border: none;
            outline: none;
            font-family: 'alo', Arial, sans-serif;
            color: #333;
            padding: 2px;
            resize: none;
            overflow: hidden;
            white-space: nowrap;
        }

        .ticket-field:focus {
            outline: none;
            border: none;
            box-shadow: none;
        }

        /* Route Number */
        .route-number {
            top: 109px;
            left: 28px;
            width: 300px;
            font-size: 11px;
            font-weight: 900;
            font-family: 'alo', Arial Black, Arial, sans-serif;
            text-shadow: 0.5px 0 0 currentColor;
            letter-spacing: 0.5px;
            text-align: left;
        }

        /* From Location */
        .from-location {
            top: 164px;
            left: 10px;
            width: 120px;
            font-size: 15px;
        }

        /* To Location */
        .to-location {
            top: 164px;
            left: 228px;
            width: 120px;
            font-size: 15px;
        }

        /* Passengers */
        .passengers {
            top: 212px;
            left: 11px;
            width: 40px;
            font-size: 16px;
        }

        /* Fare */
        .fare {
            top: 209px;
            left: 228px;
            width: 80px;
            font-size: 15px;
        }

        /* Ticket Number */
        .ticket-number {
            top: 262px;
            left: 10px;
            width: 190px;
            font-size: 15px;
        }

        /* Valid Date */
        .valid-date {
            top: 259px;
            left: 228px;
            width: 100px;
            font-size: 15px;
        }

        /* Booking ID */
        .booking-id {
            top: 311px;
            left: 11px;
            width: 140px;
            font-size: 15px;
        }

        /* Bus Number */
        .bus-number {
            top: 307px;
            left: 228px;
            width: 100px;
            font-size: 15px;
        }

        /* Transaction ID */
        .transaction-id {
            top: 360px;
            left: 11px;
            width: 200px;
            font-size: 15px;
        }

        /* Bus Type (AC/Non-AC) */
        .bus-type {
            top: 360px;
            left: 200px;
            width: 80px;
            font-size: 13px;
            font-weight: 600;
        }

        .preview-image {
            max-width: 280px;
            max-height: 400px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            margin: 20px 0;
            width: 100%;
            height: auto;
        }

        .preview-container {
            text-align: center;
            margin: 30px 0;
            padding: 24px;
            background: #f8f9fa;
            border-radius: 16px;
            border: 1px solid #e9ecef;
        }

        .preview-container h4 {
            margin: 0 0 20px 0;
            color: var(--color-black);
            font-weight: 600;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-divider {
            width: 60px;
            height: 2px;
            background: var(--color-black);
            margin: 20px auto;
            border-radius: 1px;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        /* Compact configuration card styles */
        .config-card {
            padding: 18px !important;
            margin-bottom: 16px !important;
        }

        .config-card .card-title {
            font-size: 14px;
            margin: 0 0 12px 0;
            color: var(--color-gray-medium);
        }

        .config-card .form-row {
            gap: 10px;
            margin-bottom: 12px;
        }

        .config-card .form-group {
            min-width: 140px;
        }

        .config-card .form-group label {
            font-size: 11px;
            margin-bottom: 4px;
        }

        .config-card .form-group input {
            padding: 8px 10px;
            font-size: 13px;
            border-radius: 6px;
        }

        /* Smaller route option buttons */
        .route-btn {
            padding: 10px 16px !important;
            font-size: 12px !important;
            font-weight: 500 !important;
            margin: 4px 2px !important;
            max-width: 120px !important;
            border-radius: 8px !important;
            letter-spacing: 0.3px !important;
        }

        .route-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin: 16px 0;
        }

        /* Datalist styling to ensure dropdowns work */
        datalist {
            display: none;
        }

        input[list] {
            position: relative;
            z-index: 1;
        }

        /* Ensure parent containers don't interfere with datalist */
        .config-card {
            overflow: visible !important;
        }

        .form-group {
            position: relative;
            overflow: visible !important;
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 16px;
                border-radius: 12px;
            }

            .config-card {
                padding: 14px !important;
                margin-bottom: 12px !important;
            }
            
            .form-row {
                flex-direction: column;
                gap: 8px;
            }

            .config-card .form-row {
                gap: 6px;
                margin-bottom: 10px;
            }
            
            .form-group {
                min-width: 100%;
                margin-bottom: 8px;
            }

            .config-card .form-group {
                min-width: 100%;
                margin-bottom: 6px;
            }
            
            .ticket-container {
                width: 100%;
                max-width: 350px;
                height: auto;
                aspect-ratio: 398/553;
            }
            
            .btn {
                width: 100%;
                max-width: none;
                margin: 6px 0;
            }

            .route-btn {
                max-width: none !important;
                padding: 8px 12px !important;
                font-size: 11px !important;
                margin: 3px 0 !important;
            }

            .route-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
            
            .InputGroup {
                width: 100%;
                max-width: none;
                height: 50px;
            }
            
            .app-title {
                font-size: 20px;
            }
            
            th, td {
                padding: 4px 6px;
                font-size: 11px;
            }
            
            /* Mobile ticket field positioning adjustments */
            .route-number {
                top: 94px;
                left: 29px;
                width: 264px;
                font-size: 10px;
             }       

            .from-location {
                top: 144px;
                left: 9px;
                width: 105px;
                font-size: 13px;
            }

            .to-location {
                top: 144px;
                left: 200px;
                width: 105px;
                font-size: 13px;
            }

            .passengers {
                top: 186px;
                left: 10px;
                width: 35px;
                font-size: 14px;
            }

            .fare {
                top: 184px;
                left: 200px;
                width: 70px;
                font-size: 13px;
            }

            .ticket-number {
                top: 230px;
                left: 9px;
                width: 167px;
                font-size: 13px;
            }

            .valid-date {
                top: 228px;
                left: 200px;
                width: 88px;
                font-size: 13px;
            }

            .booking-id {
                top: 273px;
                left: 10px;
                width: 123px;
                font-size: 13px;
            }

            .bus-number {
                top: 270px;
                left: 200px;
                width: 88px;
                font-size: 13px;
            }

            .transaction-id {
                top: 315px;
                left: 10px;
                width: 176px;
                font-size: 13px;
            }
        }

        /* Focus states for accessibility */
        .btn:focus {
            outline: 3px solid rgba(0, 0, 0, 0.3);
            outline-offset: 2px;
        }

        /* Loading animation for buttons */
        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: button-loading-spinner 1s ease infinite;
        }

        @keyframes button-loading-spinner {
            from {
                transform: rotate(0turn);
            }
            to {
                transform: rotate(1turn);
            }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <img src="./DTC-Ticket Booking_files/dtcImage.png" class="app-logo" alt="DTC Logo">
        <h1 class="app-title">DTC Ticket Generator</h1>
    </div>
    
    <!-- Fare Breakdown Table -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div class="card-title" style="margin: 0;">Fare Breakdown</div>
            
            <!-- AC/Non-AC Toggle -->
            <div class="InputGroup" style="width: 160px; height: 35px; margin: 0;">
                <input type="radio" id="non-ac" value="non-ac" name="bus-type">
                <label for="non-ac" style="font-size: 12px;">Non-AC</label>
                
                <input type="radio" checked="checked" id="ac" value="ac" name="bus-type">
                <label for="ac" style="font-size: 12px;">AC</label>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Amount (Rs)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Base Fare</td>
                    <td id="baseFare">15.00</td>
                </tr>
                <tr>
                    <td>Ticket(s)</td>
                    <td id="ticketCount">1</td>
                </tr>
                <tr>
                    <td>Total Fare</td>
                    <td id="totalFare">15.00</td>
                </tr>
                <tr>
                    <td colspan="2"><hr /></td>
                </tr>
                <tr>
                    <td>Discount</td>
                    <td id="discount">- 1.15</td>
                </tr>
                <tr>
                    <td colspan="2"><hr /></td>
                </tr>
                <tr style="font-weight: 600;">
                    <td>Grand Total</td>
                    <td id="grandTotal">13.85</td>
                </tr>
            </tbody>
        </table>

        <div class="section-divider"></div>

        <div class="InputGroup"> 
            <input type="radio" checked="checked" id="bg-1" value="url('blank-ticket.JPG')" name="backg" >
            <label for="bg-1">Ticket</label>

            <input type="radio" id="bg-2" value="url('blnk.jpg')" name="backg" > 
            <label for="bg-2">Blank</label>  
        </div>
        
        <input type="button" class="btn btn-outline" style="margin: 20px auto; width: 30%; max-width: 150px; display: block;" value="Down" onclick="downstp()"> 
    </div>
    
    <!-- Combined Actions Card -->
    <div class="card">
        <div class="card-title">Quick Actions</div>
        
        <!-- Pay Now Section -->
        <a href="/pay.html" style="text-decoration: none;">
            <button class="btn btn-success">Pay Now</button>
        </a>
        
        <div class="section-divider"></div>
        
        <!-- Bus No Section -->
        <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-weight: 600; color: var(--color-black); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px;">Past Route</div>
            
            <div class="route-grid">
                <button class="btn btn-outline route-btn" onclick="f827UP()">827UP</button>
                <button class="btn btn-outline route-btn" onclick="f628STLUp()">628STLUp</button>
                <button class="btn btn-outline route-btn" onclick="f835UP()">835UP</button>
                <button class="btn btn-outline route-btn" onclick="f821DOWN()">821DOWN</button>
            </div>
        </div>
        
        <div class="section-divider"></div>
        
        <!-- Action Buttons -->
        <div class="action-grid">
            <button class="btn btn-primary" onclick="shot()">Generate</button>
            <button class="btn btn-primary" onclick="downloadTicket()">Download Ticket</button>
        </div>

        <div id="previewContainer" class="preview-container" style="display: none;">
            <h4>Preview</h4>
            <div id="previewImageContainer"></div>
        </div>
    </div>
    
    <!-- Ticket Preview at the top -->
    <div class="ticket-preview">
        <div id="ticketContainer" class="ticket-container">
            <!-- All input fields grouped in a single container for easy positioning -->
            <div id="fieldsContainer" class="fields-container">
                <!-- Route Number -->
                <input type="text" class="ticket-field route-number" id="ticketRouteNumber">
                
                <!-- From Location -->
                <input type="text" class="ticket-field from-location" id="ticketFromLocation">
                
                <!-- To Location -->
                <input type="text" class="ticket-field to-location" id="ticketToLocation">
                
                <!-- Passengers -->
                <input type="text" class="ticket-field passengers" id="ticketPassengers">
                
                <!-- Fare -->
                <input type="text" class="ticket-field fare" id="ticketFare">
                
                <!-- Ticket Number -->
                <input type="text" class="ticket-field ticket-number" id="ticketNumber">
                
                <!-- Valid Date -->
                <input type="text" class="ticket-field valid-date" id="ticketValidDate">
                
                <!-- Booking ID -->
                <input type="text" class="ticket-field booking-id" id="ticketBookingId">
                
                <!-- Bus Number -->
                <input type="text" class="ticket-field bus-number" id="ticketBusNumber">
                
                <!-- Transaction ID -->
                <input type="text" class="ticket-field transaction-id" id="ticketTransactionId">
            </div>
        </div>
    </div>

    <!-- Controls Panel at the bottom -->
    <div class="card config-card">
        <div class="card-title">Configuration</div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="routeNumber">Route</label>
                <input type="text" id="routeNumber" list="bus" value="821UP" placeholder="Route number">
            </div>
            
            <div class="form-group">
                <label for="fromLocation">From</label>
                <input type="text" id="fromLocation" list="stop" value="Arjun Park" placeholder="Source">
            </div>
            
            <div class="form-group">
                <label for="toLocation">To</label>
                <input type="text" id="toLocation" list="stop" value="Jaffar Pur Kalan" placeholder="Destination">
            </div>
        </div>

        <!-- Datalists for autocomplete -->
        <datalist id="bus">
            <option value="821UP">821UP</option>
            <option value="821Down">821Down</option>
            <option value="827DOWN">827DOWN</option>
            <option value="827UP">827UP</option>
            <option value="628STLDown">628STLDown</option>
            <option value="628STLUp">628STLUp</option>
            <option value="844DOWN">844DOWN</option>
            <option value="844STLDown">844STLDown</option>
            <option value="835UP">835UP</option>
            <option value="836EUp">836EUp</option>
            <option value="968UP">968UP</option>
            <option value="835DOWN">835DOWN</option>
        </datalist>

        <datalist id="stop">
            <option value="Chhawla Village">Chhawla Village</option>
            <option value="Scindia House">Scindia House</option>
            <option value="Janak Puri Check Post">Janak Puri Check Post</option>
            <option value="Palam Airport / IGI Airport T1">Palam Airport / IGI Airport T1</option>
            <option value="Dwarka More Metro St">Dwarka More Metro St</option>
            <option value="Ghumman Heera Village">Ghumman Heera Village</option>
            <option value="Paprawat Village">Paprawat Village</option>
            <option value="Munirka Flats (Dwarka)">Munirka Flats (Dwarka)</option>
            <option value="Tikri Village">Tikri Village</option>
            <option value="Tikri Piyau / Azad Hind Gram">Tikri Piyau / Azad Hind Gram</option>
            <option value="Laxmi Vihar">Laxmi Vihar</option>
            <option value="ISBT Anand Vihar">ISBT Anand Vihar</option>
            <option value="Chetan Bihari Mandir Sant Nagar">Chetan Bihari Mandir Sant Nagar</option>
            <option value="Nangal Thakran">Nangal Thakran</option>
            <option value="Samaspur Khalsa">Samaspur Khalsa</option>
            <option value="Tughlaqabad Extension">Tughlaqabad Extension</option>
            <option value="Rohini Sec 9">Rohini Sec 9</option>
            <option value="Kaaliyawas Village HR">Kaaliyawas Village HR</option>
            <option value="Filmistan">Filmistan</option>
            <option value="KD Block Ashok Vihar">KD Block Ashok Vihar</option>
            <option value="Bajitpur Mandir">Bajitpur Mandir</option>
            <option value="Swami Malai Mandir">Swami Malai Mandir</option>
            <option value="Osho Dhyan Mandir Jhatikra Road">Osho Dhyan Mandir Jhatikra Road</option>
            <option value="Karala Crossing">Karala Crossing</option>
            <option value="Ram Pura (Rohtak Road)">Ram Pura (Rohtak Road)</option>
            <option value="Rewla Khanpur Depot">Rewla Khanpur Depot</option>
            <option value="Air Force Station">Air Force Station</option>
            <option value="Ranhola Village">Ranhola Village</option>
            <option value="Bakhtawar Pur Garhi">Bakhtawar Pur Garhi</option>
            <option value="Durga Vihar">Durga Vihar</option>
            <option value="Rohini Sec3/4 Xing">Rohini Sec3/4 Xing</option>
            <option value="A Block Gopal Nagar">A Block Gopal Nagar</option>
            <option value="Gokul Puri">Gokul Puri</option>
            <option value="Kakrola More">Kakrola More</option>
            <option value="Tuda Mandi">Tuda Mandi</option>
            <option value="Nangli Dairy">Nangli Dairy</option>
            <option value="Nangli Sakrawati">Nangli Sakrawati</option>
            <option value="NSIT (Netaji Subhas Institute)">NSIT (Netaji Subhas Institute)</option>
            <option value="Safdurjung Hospital / AIIMS">Safdurjung Hospital / AIIMS</option>
            <option value="INA Colony">INA Colony</option>
            <option value="Vigyan Bhawan">Vigyan Bhawan</option>
            <option value="Dashrath Puri">Dashrath Puri</option>
            <option value="Baba Hari Dass Nagar">Baba Hari Dass Nagar</option>
            <option value="Ambedkar Nagar Terminal">Ambedkar Nagar Terminal</option>
            <option value="Ghoga Village">Ghoga Village</option>
            <option value="Gurudwara Nanak Pyau">Gurudwara Nanak Pyau</option>
            <option value="Khichripur Village">Khichripur Village</option>
            <option value="Talkatora Road">Talkatora Road</option>
            <option value="SPM College">SPM College</option>
            <option value="Nand Nagri Ext">Nand Nagri Ext</option>
            <option value="Holambi Kalan JJ Colony">Holambi Kalan JJ Colony</option>
            <option value="Jija Bai Udyogic Sansthan">Jija Bai Udyogic Sansthan</option>
            <option value="Peera Garhi Depot">Peera Garhi Depot</option>
            <option value="Ghevra Village (Savda Road)">Ghevra Village (Savda Road)</option>
            <option value="DDA Flats Lado Sarai">DDA Flats Lado Sarai</option>
            <option value="Laxmi Nagar Metro Station">Laxmi Nagar Metro Station</option>
            <option value="Rani Bagh / Railway Colony">Rani Bagh / Railway Colony</option>
            <option value="Najafgarh Terminal">Najafgarh Terminal</option>
            <option value="Supreme Court">Supreme Court</option>
            <option value="Bhati Mines (T)">Bhati Mines (T)</option>
            <option value="Gulab House">Gulab House</option>
            <option value="Dhansa Stand">Dhansa Stand</option>
            <option value="Munirka Village (T)">Munirka Village (T)</option>
            <option value="Rajeev Ratan Aawas Yojna">Rajeev Ratan Aawas Yojna</option>
            <option value="Issapur Xing">Issapur Xing</option>
            <option value="Kishan Ganj Railway Station">Kishan Ganj Railway Station</option>
            <option value="Rawta Crossing (Ujwa Village Road)">Rawta Crossing (Ujwa Village Road)</option>
            <option value="Bankner Crossing">Bankner Crossing</option>
            <option value="Palam Vihar More">Palam Vihar More</option>
            <option value="Nangloi">Nangloi</option>
            <option value="Dwarka Sec19 Pkt.2.">Dwarka Sec19 Pkt.2.</option>
            <option value="R K Puram Sec7 Xing">R K Puram Sec7 Xing</option>
            <option value="Bhajan Pura">Bhajan Pura</option>
            <option value="Nand Nagari Terminal">Nand Nagari Terminal</option>
            <option value="PS Mandir Marg">PS Mandir Marg</option>
            <option value="Alipur Village GT Road">Alipur Village GT Road</option>
            <option value="Vidhan Sabha Metro Station">Vidhan Sabha Metro Station</option>
            <option value="A-3 Janak Puri">A-3 Janak Puri</option>
            <option value="Rani Jhansi Road Jhande Walan">Rani Jhansi Road Jhande Walan</option>
            <option value="Rohini Sec 23 Pkt 1 (Green Hill Aptt.)">Rohini Sec 23 Pkt 1 (Green Hill Aptt.)</option>
            <option value="RR Hospital / Maharana Pratap Chowk">RR Hospital / Maharana Pratap Chowk</option>
            <option value="Shahbad Daulatpur School">Shahbad Daulatpur School</option>
            <option value="Kendriya Terminal / Gurudwara Rakab Ganj">Kendriya Terminal / Gurudwara Rakab Ganj</option>
            <option value="Janak Setu">Janak Setu</option>
            <option value="Panchayat Ghar">Panchayat Ghar</option>
            <option value="Kapashera Village">Kapashera Village</option>
            <option value="Mundhela Khurd Village">Mundhela Khurd Village</option>
            <option value="Shikar Pur Crossing">Shikar Pur Crossing</option>
            <option value="R K Puram Sec 1/4">R K Puram Sec 1/4</option>
            <option value="CD Block Jahangir Puri">CD Block Jahangir Puri</option>
            <option value="Nangloi Metro Station">Nangloi Metro Station</option>
            <option value="Pipal Wala Road Crossing Mohan Garden">Pipal Wala Road Crossing Mohan Garden</option>
            <option value="Madarsa / Welcome Seelam Pur">Madarsa / Welcome Seelam Pur</option>
            <option value="Shiv Murti (NH8)">Shiv Murti (NH8)</option>
            <option value="Arjun Park">Arjun Park</option>
            <option value="Azadpur / Kewal Park">Azadpur / Kewal Park</option>
            <option value="Akshardham Temple / Pusta Crossing">Akshardham Temple / Pusta Crossing</option>
            <option value="Ras Vihar Apartment (PS Madhu Vihar)">Ras Vihar Apartment (PS Madhu Vihar)</option>
            <option value="Kirby Place">Kirby Place</option>
            <option value="Western Court">Western Court</option>
            <option value="Sanjay Colony">Sanjay Colony</option>
            <option value="Police Station Timarpur">Police Station Timarpur</option>
            <option value="Avantika Sec 2">Avantika Sec 2</option>
            <option value="SFS Flats Sec-2 Power House">SFS Flats Sec-2 Power House</option>
            <option value="Rojdoot Hotel">Rojdoot Hotel</option>
            <option value="President Cabinet Apartment">President Cabinet Apartment</option>
            <option value="Sapera Basti Crossing">Sapera Basti Crossing</option>
            <option value="Maharaja Surajmal Stadium">Maharaja Surajmal Stadium</option>
            <option value="Surehra Community Centre">Surehra Community Centre</option>
            <option value="Rang Puri (NH8)">Rang Puri (NH8)</option>
            <option value="Rawta Crossing">Rawta Crossing</option>
            <option value="Mile Stone Factory">Mile Stone Factory</option>
            <option value="Durlabh Nath Vatika Mangol Puri">Durlabh Nath Vatika Mangol Puri</option>
            <option value="Peera Garhi Chowk">Peera Garhi Chowk</option>
            <option value="Avtar Enclave / New Multan Nagar">Avtar Enclave / New Multan Nagar</option>
            <option value="Rawta Crossing (Dhansa Road)">Rawta Crossing (Dhansa Road)</option>
            <option value="Bharthal Village">Bharthal Village</option>
            <option value="COD Ring Road">COD Ring Road</option>
            <option value="Bharthal Chowk (Bharthal Road)">Bharthal Chowk (Bharthal Road)</option>
            <option value="C8 Keshav Puram">C8 Keshav Puram</option>
            <option value="Mundhela Crossing (Mundhela Road)">Mundhela Crossing (Mundhela Road)</option>
            <option value="Batra Cinema">Batra Cinema</option>
            <option value="Krishna Nagar / Gopal Nagar">Krishna Nagar / Gopal Nagar</option>
            <option value="Ghuman Hera DTC Depot Crossing">Ghuman Hera DTC Depot Crossing</option>
            <option value="B3 Vasant Kunj Kendriya Vidhyalaya">B3 Vasant Kunj Kendriya Vidhyalaya</option>
            <option value="Chand Cinema">Chand Cinema</option>
            <option value="Dhakewala Bawana">Dhakewala Bawana</option>
            <option value="Madipur JJ Colony Terminal">Madipur JJ Colony Terminal</option>
            <option value="Vriddha Ashram">Vriddha Ashram</option>
            <option value="Kirti Nagar">Kirti Nagar</option>
            <option value="Tilak Nagar">Tilak Nagar</option>
            <option value="Dwarka More Metro Station (Sewak Park)">Dwarka More Metro Station (Sewak Park)</option>
            <option value="Anand Parvat Terminal">Anand Parvat Terminal</option>
            <option value="Zakir Hussain College">Zakir Hussain College</option>
            <option value="Akshardham Mandir">Akshardham Mandir</option>
            <option value="Goela Dairy Crossing">Goela Dairy Crossing</option>
            <option value="Shiv Mandir">Shiv Mandir</option>
            <option value="Kendriya Terminal (Church Road)">Kendriya Terminal (Church Road)</option>
            <option value="Janak Cinema">Janak Cinema</option>
            <option value="ESI Dispensary/CGHS Dispensary">ESI Dispensary/CGHS Dispensary</option>
            <option value="Chowki No 2 / Gulabi Bagh Crossing">Chowki No 2 / Gulabi Bagh Crossing</option>
            <option value="Narmada Apartment">Narmada Apartment</option>
            <option value="Bhairon Enclave">Bhairon Enclave</option>
            <option value="JhulJhuli Village">JhulJhuli Village</option>
            <option value="Badli Crossing">Badli Crossing</option>
            <option value="Ramprashta Crossing">Ramprashta Crossing</option>
            <option value="Guru Hari Kishan Nagar">Guru Hari Kishan Nagar</option>
            <option value="Shri Golok Dham Bijwasan School">Shri Golok Dham Bijwasan School</option>
            <option value="Jag Jivan Ram Hospital">Jag Jivan Ram Hospital</option>
            <option value="Kasturba Gandhi Crossing">Kasturba Gandhi Crossing</option>
            <option value="Jaffar Pur Kalan">Jaffar Pur Kalan</option>
            <option value="Khajuri">Khajuri</option>
            <option value="Anand Gram">Anand Gram</option>
            <option value="Sant Pura">Sant Pura</option>
            <option value="New Rajinder Nagar Post Office">New Rajinder Nagar Post Office</option>
        </datalist>

        <div class="form-row">
            <div class="form-group">
                <label for="passengers">Passengers</label>
                <input type="number" id="passengers" value="1" min="1" max="10">
            </div>
            
            <div class="form-group">
                <label for="fare">Fare</label>
                <input type="text" id="fare" value="₹ 13.85" placeholder="Amount">
            </div>
            
            <div class="form-group">
                <label for="busNumber">Bus No.</label>
                <input type="text" id="busNumber" value="DL1PD985" placeholder="Bus number">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="validDate">Valid Date</label>
                <input type="text" id="validDate" readonly placeholder="Date">
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div style="text-align: center; margin: 40px 0 20px 0; color: var(--color-gray-medium); font-size: 14px;">
        <div style="margin-bottom: 10px; font-weight: 500;">DTC Ticket Generator</div>
        <a href="index.html" style="color: var(--color-black); text-decoration: none; font-weight: 500;">← Back to Home</a>
    </div>

    <script>
        // Initialize with current date
        function initializeDate() {
            const currentDate = new Date();
            const day = String(currentDate.getDate()).padStart(2, '0');
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const year = currentDate.getFullYear();
            const formattedDate = `${day}-${month}-${year}`;
            
            document.getElementById('validDate').value = formattedDate;
            updateTicketFields();
        }

        // Generate random strings for ticket/booking/transaction IDs
        function generateRandomString(length, numbersOnly = false) {
            const chars = numbersOnly ? '0123456789' : 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Generate ticket data
        function generateTicket() {
            // Get current date in the format needed
            const currentDate = new Date();
            const day = String(currentDate.getDate()).padStart(2, '0');
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const year = currentDate.getFullYear();
            
            // Create date strings for ticket generation
            const fullDate = `${day}${month}${year}`; // 28072025
            const shortDate = `${day}${month}${String(year).slice(-2)}`; // 280725
            
            // Generate ticket number: T + fullDate + 3 random digits + random string
            const randomDigits = Math.floor(Math.random() * 900) + 100; // 3 digit number (100-999)
            const randomString = generateRandomString(8); // 8 character random string
            const ticketNo = `T${fullDate}${randomDigits}${randomString}`;
            
            // Generate booking ID: shortDate + 6 random digits
            const randomBookingDigits = Math.floor(Math.random() * 900000) + 100000; // 6 digit number (100000-999999)
            const bookingId = `${shortDate}${randomBookingDigits}`;
            
            // Generate transaction ID (unchanged)
            const transactionId = 'dtc-' + generateRandomString(15);
            
            document.getElementById('ticketNumber').value = ticketNo;
            document.getElementById('ticketBookingId').value = bookingId;
            document.getElementById('ticketTransactionId').value = transactionId;
            
            updateTicketFields();
        }

        // Update all ticket fields from form inputs
        function updateTicketFields() {
            document.getElementById('ticketRouteNumber').value = document.getElementById('routeNumber').value;
            document.getElementById('ticketFromLocation').value = document.getElementById('fromLocation').value;
            document.getElementById('ticketToLocation').value = document.getElementById('toLocation').value;
            document.getElementById('ticketPassengers').value = document.getElementById('passengers').value;
            document.getElementById('ticketFare').value = document.getElementById('fare').value;
            document.getElementById('ticketBusNumber').value = document.getElementById('busNumber').value;
            document.getElementById('ticketValidDate').value = document.getElementById('validDate').value;
        }

        // Update form inputs from ticket fields (reverse sync)
        function updateFormFields() {
            document.getElementById('routeNumber').value = document.getElementById('ticketRouteNumber').value;
            document.getElementById('fromLocation').value = document.getElementById('ticketFromLocation').value;
            document.getElementById('toLocation').value = document.getElementById('ticketToLocation').value;
            document.getElementById('passengers').value = document.getElementById('ticketPassengers').value;
            document.getElementById('fare').value = document.getElementById('ticketFare').value;
            document.getElementById('busNumber').value = document.getElementById('ticketBusNumber').value;
            document.getElementById('validDate').value = document.getElementById('ticketValidDate').value;
        }

        // Set quick route data
        function setRoute(route, from, to) {
            document.getElementById('routeNumber').value = route;
            document.getElementById('fromLocation').value = from;
            document.getElementById('toLocation').value = to;
            updateTicketFields();
        }

        // Randomize all data
        function randomizeData() {
            const routes = ['827UP', '628STLUp', '835UP', '821DOWN', '844UP', '968UP'];
            const buses = ['DL1PD985', 'DL1PC123', 'DL1PA456', 'DL1PB789', 'DL1PE321'];
            const fares = ['₹ 13.85', '₹ 15.00', '₹ 12.50', '₹ 18.25', '₹ 20.00'];
            
            document.getElementById('routeNumber').value = routes[Math.floor(Math.random() * routes.length)];
            document.getElementById('busNumber').value = buses[Math.floor(Math.random() * buses.length)];
            document.getElementById('fare').value = fares[Math.floor(Math.random() * fares.length)];
            
            generateTicket();
        }

        // Generate ticket image preview (like book.html shot function)
        function shot() {
            // Ensure all fields are properly updated
            updateTicketFields();
            
            // Wait a moment for DOM to settle
            setTimeout(() => {
                var node = document.getElementById('ticketContainer');
                
                // Remove focus from any active input field
                document.activeElement.blur();
                
                // Get the actual rendered dimensions
                const rect = node.getBoundingClientRect();
                
                var options = {
                    width: rect.width,
                    height: rect.height,
                    style: {
                        margin: '0',
                        padding: '0',
                        border: 'none',
                        boxShadow: 'none'
                    },
                    bgcolor: 'transparent'
                };
                
                domtoimage.toPng(node, options).then(function(dataUrl) {
                    // Clear previous preview
                    const previewContainer = document.getElementById('previewImageContainer');
                    previewContainer.innerHTML = '';
                    
                    // Create new preview image
                    var img = new Image();
                    img.src = dataUrl;
                    img.className = 'preview-image';
                    img.alt = 'Ticket Preview';
                    img.style.maxWidth = '100%';
                    img.style.height = 'auto';
                    
                    // Add to preview container
                    previewContainer.appendChild(img);
                    
                    // Show preview container
                    document.getElementById('previewContainer').style.display = 'block';
                }).catch(function(error) {
                    console.error('oops, something went wrong!', error);
                });
            }, 100);
        }

        // Download ticket as PNG
        function downloadTicket() {
            // First ensure all fields are properly updated
            updateTicketFields();
            
            // Wait a moment for DOM to settle
            setTimeout(() => {
                window.scrollTo(0, 0);
                var node = document.getElementById('ticketContainer');
                
                // Remove focus from any active input field
                document.activeElement.blur();
                
                // Get the actual rendered dimensions
                const rect = node.getBoundingClientRect();
                
                var options = {
                    width: rect.width,
                    height: rect.height,
                    style: {
                        margin: '0',
                        padding: '0',
                        border: 'none',
                        boxShadow: 'none'
                    },
                    bgcolor: 'transparent'
                };
                
                domtoimage.toPng(node, options).then(function(dataUrl) {
                    downloadURI(dataUrl, "DTC-Ticket.png")
                }).catch(function(error) {
                    console.error('oops, something went wrong!', error);
                });
            }, 100);
        }

        function downloadURI(uri, name) {
            var link = document.createElement("a");
            link.download = name;
            link.href = uri;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            delete link;
        }

        // Event listeners for real-time updates
        document.addEventListener('DOMContentLoaded', function() {
            // Check for bus number parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const busNumber = urlParams.get('busNumber');
            console.log('URL parameters:', window.location.search);
            console.log('Bus number from URL:', busNumber);
            
            if (busNumber) {
                console.log('Setting bus number to:', busNumber);
                document.getElementById('busNumber').value = busNumber;
                document.getElementById('ticketBusNumber').value = busNumber;
            }

            initializeDate();
            generateTicket();
            
            // Add event listeners to form inputs (control panel to ticket)
            const inputs = ['routeNumber', 'fromLocation', 'toLocation', 'passengers', 'fare', 'busNumber', 'validDate'];
            inputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', updateTicketFields);
            });

            // Add event listeners to ticket fields (ticket to control panel)
            const ticketFields = ['ticketRouteNumber', 'ticketFromLocation', 'ticketToLocation', 'ticketPassengers', 'ticketFare', 'ticketBusNumber', 'ticketValidDate'];
            ticketFields.forEach(fieldId => {
                document.getElementById(fieldId).addEventListener('input', updateFormFields);
            });

            // Add event listeners for background radio buttons
            const radioButtons = document.querySelectorAll('input[name="backg"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        changeBackground(this.value);
                    }
                });
            });

            // Add event listeners for AC/Non-AC toggle
            const busTypeButtons = document.querySelectorAll('input[name="bus-type"]');
            busTypeButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateFareTable();
                });
            });

            // Add event listener for passengers input to update table
            document.getElementById('passengers').addEventListener('input', updateFareTable);
            
            // Initial fare table update
            updateFareTable();
        });

        // Function to change ticket background
        function changeBackground(backgroundUrl) {
            const ticketContainer = document.getElementById('ticketContainer');
            ticketContainer.style.backgroundImage = backgroundUrl;
        }

        // Function to update fare breakdown table based on passengers and bus type
        function updateFareTable() {
            const passengers = parseInt(document.getElementById('passengers').value) || 1;
            
            // Check if AC or Non-AC is selected
            const isAC = document.getElementById('ac').checked;
            const baseFarePerTicket = isAC ? 25 : 15;
            
            const discount = isAC ? 2.15 : 1.15;
            
            const totalFare = baseFarePerTicket * passengers;
            const grandTotal = totalFare - discount;
            
            // Update table values
            document.getElementById('baseFare').textContent = baseFarePerTicket.toFixed(2);
            document.getElementById('ticketCount').textContent = passengers;
            document.getElementById('totalFare').textContent = totalFare.toFixed(2);
            document.getElementById('discount').textContent = `- ${discount}`;
            document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
            
            // Update fare input field
            document.getElementById('fare').value = `₹ ${grandTotal.toFixed(2)}`;
            updateTicketFields();
        }

        // Bus number button functions (matching book.html functionality)
        function f827UP() {
            document.getElementById('routeNumber').value = '827UP';
            document.getElementById('fromLocation').value = 'Arjun Park';
            document.getElementById('toLocation').value = 'Jaffar Pur Kalan';
            updateTicketFields();
        }

        function f628STLUp() {
            document.getElementById('routeNumber').value = '628STLUp';
            document.getElementById('fromLocation').value = 'Arjun Park';
            document.getElementById('toLocation').value = 'Jaffar Pur Kalan';
            updateTicketFields();
        }

        function f835UP() {
            document.getElementById('routeNumber').value = '835UP';
            document.getElementById('fromLocation').value = 'Arjun Park';
            document.getElementById('toLocation').value = 'Rawta Crossing';
            updateTicketFields();
        }

        function f821DOWN() {
            document.getElementById('routeNumber').value = '821DOWN';
            document.getElementById('fromLocation').value = 'Jaffar Pur Kalan';
            document.getElementById('toLocation').value = 'Arjun Park';
            updateTicketFields();
        }

        // Down button function (sets specific route data)
        function downstp() {
            document.getElementById('routeNumber').value = '628STLDown';
            document.getElementById('fromLocation').value = 'Samaspur Khalsa';
            document.getElementById('toLocation').value = 'Dwarka More Metro St';
            updateTicketFields();
        }
    </script>
</body>
</html>
